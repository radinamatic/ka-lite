<!DOCTYPE HTML>
{% load staticfiles %}
{% load i18n %}
{% load i18n_filters %}
{% load my_filters %}
{% load compress %}

{% get_current_language as lang_code %}
<html lang="{{ lang_code }}">
    <head>
        <!--[if lt IE 9]> 
              <script src="{% static "js/html5shiv.js" %}"></script>
        <![endif] -->

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="wot-verification" content="075abe861486e6bb3ab9"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% block titletag %}
        <title>{% block title %}{% trans "Welcome" %}{% trans title %}{% endblock title %} | KA Lite</title>
        {% endblock %}

        {% compress css file basecss %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/jquery-ui/jquery-ui.min.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
		<link rel="stylesheet" type="text/css" href="{% static 'css/distributed/bootstrap-overrides.css' %}">	
		<link rel="stylesheet" type="text/css" href="{% static 'css/coachreports/events_view.css' %}">	
        <link rel="stylesheet" type="text/css" href="{% static 'css/distributed/khan-site.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/distributed/khan-lite.css' %}">
        <link href="{% static "fonts/style.css" %}" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="{% static 'css/distributed/search_autocomplete.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.qtip.min.css' %}">
        {% endcompress %}

        <!-- INTROJS.CSS testing -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/inline/introjs.css' True %}">

        <!-- CSS for dynamic settings -->
        <link rel="stylesheet" type="text/css" href="{% url 'dynamic_css' %}">

        {% block headcss %}{% endblock headcss %}
        <link rel="shortcut icon" href="{% static "images/distributed/favicon.ico" %}">
        {# In some versions of IE, console isn't defined, which can lead to JS errors #}
        <script type="text/javascript">
            window.console = window.console || {log: function() {}};
        </script>

        <script type="text/javascript" src="{% url 'dynamic_js' %}"></script>

        {# Use JS to help IE5.5-IE8 support modern browser features, especially for CSS and PNGs #}
        <!--[if lt IE 8]>
        {# <script src="{% static "js/IE8.js" %}"></script> #}
        <![endif]-->

        <script type="text/javascript">
            window.onerror=function(msg){
                window.js_errors = window.js_errors || [];
                window.js_errors.push(msg);
            }           
        </script>

        {% if request.in_context_localized %}
            <script type="text/javascript">
              var _jipt = [];
              _jipt.push(['project', 'ka-lite']);
            </script>
            <script type="text/javascript" src="//cdn.crowdin.com/jipt/jipt.js"></script>
        {% endif %}

        {% if settings.DEBUG %}
        <script src="{% url 'js_reverse' %}" type="text/javascript"></script>
        {% else %}
        <script src="{% static 'django_js_reverse/js/reverse.js' %}"></script>
        {% endif %}

        {% compress js file basejs %}

        <!-- JS translation file statically included as a back-up, so that if the saved file below isn't available, we don't choke. -->
        <script type="text/javascript" src="{% static 'js/i18n/en.js' %}"></script>

        {% if current_language != "en" %}
        <!-- JS translation files dynamically generated by django, then saved to the static file below -->
        <script type="text/javascript" src="{% static 'js/i18n/'|add:request.language|add:'.js' %}"></script>
        {% endif %}

        {# Older versions of IE didn't have a JSON object, so this library adds it back in if needed #}
        <script type="text/javascript" src="{% static 'js/json2.js' %}"></script>

        {% block jqueryjs %}
        <script type="text/javascript" src="{% static 'js/jquery-1.9.1.min.js' %}"></script>
        <script type="text/javascript">
            jQuery.migrateMute = true;
        </script>
        {% endblock jqueryjs %}

        <script type="text/javascript" src="{% static 'js/fastclick.js' %}"></script>
        <script>

        $(function() {
            FastClick.attach(document.body);
        });
        </script>
        <script type="text/javascript" src="{% static 'js/underscore-min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/backbone/backbone.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/backbone/backbone-tastypie.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/backbone/backbone-helpers.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery-ui/jquery-ui.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.ui.touch-punch.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>

        <script type="text/javascript" src="{% static 'js/sprintf.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/purl.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/modernizr.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.ui.autocomplete.html.js' %}"></script>

        <!-- Imports for handlebars, our JS templating engine -->
        <script src="{% static "js/handlebars/handlebars-v1.3.0.js" %}"></script>
        <script src="{% static "js/handlebars/handlebars-helpers.js" %}"></script>
        <script src="{% static "js/handlebars/handlebars-wrapper.js" %}"></script>

        <script type="text/javascript" src="{% static 'js/distributed/session/models.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/khan-lite.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/distributed/distributed-server.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.qtip.min.js' %}"></script>

        {% endcompress %}

        <script src="{% url 'handlebars_templates' module_name='search' %}"></script>
        <script src="{% url 'handlebars_templates' module_name='user' %}"></script>

        {% compress js file baseviews %}
        <script src="{% static 'js/distributed/user/views.js' %}"></script>
        <script src="{% static 'js/distributed/search/views.js' %}"></script>
        {% endcompress %}


        {# Trigger tooltips for help icons #}
        <script>
            $(function(){
                $('.help-tooltip').tooltip({
                    trigger: "hover click"
                });
            });
        </script>

        <script>
        window.sessionModel.set({
          USER_URL                    : "{% url 'api_dispatch_list' resource_name='user' %}",

          STATIC_URL                  : "{% static "" %}",

          ALL_ASSESSMENT_ITEMS_URL    : "{% url 'api_dispatch_list' resource_name='assessment_item' %}",
          GET_VIDEO_LOGS_URL          : "{% url 'api_dispatch_list' resource_name='videolog' %}",
          GET_EXERCISE_LOGS_URL       : "{% url 'api_dispatch_list' resource_name='exerciselog' %}",
          GET_CONTENT_LOGS_URL        : "{% url 'api_dispatch_list' resource_name='contentlog' %}",

          KHAN_EXERCISES_SCRIPT_URL : "{% static 'perseus/ke/khan-exercise.js' %}",

          CENTRAL_SERVER_HOST         : "{{ central_server_host }}",
          SECURESYNC_PROTOCOL         : "{{ securesync_protocol }}",
          CURRENT_LANGUAGE            : "{{ current_language }}",
          CHANNEL                     : "{{ channel }}",
        });
        $(function() {
          window.statusModel.fetch_data();
          window.toggleNavbarView = new ToggleNavbarView({model: statusModel, el: "#topnav"});
        });
        </script>

        {% block headjs %}{% endblock headjs %}
        {% block analytics %}{% endblock analytics %}

        {% if inline_help %}
        <!-- inline help, introjs -->
        <script src="{% url 'handlebars_templates' module_name='inline' %}"></script>
        <script type="text/javascript" src="{% static 'js/inline/intro.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/inline/models.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/inline/views.js' %}"></script>
        {% endif %}

        <!-- Where should this function go so it gets executed onload (after everything else?)  -->
        <script type="text/javascript">
            function showSkipLinks() {
            var skipBgColor= "fff";
            var skipTextColor = "000";
            // Amend/tweak these to your satisfaction
            var textIndent = "20px";
            var skipNavHeight = "auto";
            var skipFontSize = "medium";
            var viewportwidth="100%";
            var sk_a = document.getElementsByTagName("a");
            for (i=0; i<sk_a.length; i++)
             {
                bodyEl = document.getElementsByTagName("body")[0];
                if (sk_a[i].className=="skip-link")
                    {
                    sk_a[i].onfocus=function(e){
                        this.style.width=viewportwidth;
                        this.style.padding="10px 0";
                        this.style.fontSize = skipFontSize;
                        this.style.height = skipNavHeight;
                        this.style.textIndent = textIndent;
                        this.style.backgroundColor = skipBgColor;
                        this.style.color = skipTextColor;
                        }
                    sk_a[i].onblur=function(e){
                        this.style.width="0";
                        this.style.padding="0";
                        this.style.fontSize="0px";
                        this.style.height="0";
                        this.style.textIndent="-30000px";
                        this.style.backgroundColor="transparent";
                        this.style.backgroundImage="none";
                        }
                    }
                }
            }
            function init()
            {
            showSkipLinks();
            }
            window.onload=init;
            </script>

            <!-- TODO: Better styling (like the one on webaim.com)  -->
            <style type="text/css">
            #skipLinkList li {
            list-style:none;
            }
            a.skip-link {
            position:absolute;
            top:0px;
            left:0px;
            z-index:1000 !important;
            font-size:0px;
            color:000 !important;
            display:block;
            margin:0;
            text-indent:-30000px;
            outline:none;
            text-align:left;
            filter:alpha(opacity=100);
            opacity:1;
            }
            </style>

    </head>

    <body class="{% block bodyclass %}{% endblock %}">

        <div id="skipLinkList">
            <ul>
                <!-- TODO: Implement the first two links for logged-in users ONLY  -->
                <li><a href="{%url 'homepage' %}#resume" class="skip-link">{% trans "Skip to where you left off" %}</a></li>
                <li><a href="{%url 'homepage' %}#user-name" class="skip-link">{% trans "Skip to user options" %}</a></li>
                <li><a href="{%url 'learn' %}" class="skip-link">{% trans "Jump to topics menu" %}</a></li>
            </ul>
        </div>
        <div id="wrapper">

            {# Header / Navbar #}

            <div class="navbar kalite-navbar header-footer-bg" role="banner">
              <div class="container">
                  <div class="row">

                      <div class="navbar-header">
                          {# collapse entire menu #}
                          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse" aria-hidden="true" id="navbar_toggle">
                              <span class="icon-bar"></span>
                              <span class="icon-bar"></span> 
                              <span class="icon-bar"></span>
                          </button>
                          <div class="navbar-brand">
                              <a href="{% url 'homepage' %}" title="{{ channel_data.channel_name }} {% trans 'Home' %}">
                                  <img src="/data/{{ channel }}/images/horizontal-logo-small.png" alt="{{ channel_data.channel_name }} {% trans 'logo' %}">
                              </a>
                              <div class="pull-right visible-xs sitepoint" id="points-xs"></div>
                          </div>    
                                                   
                      </div>             

                      <div class="collapse navbar-collapse top-nav" role="navigation" aria-label="Main menu">
                          <ul class="nav navbar-nav navbar-right nav-tabs" id="topnav" role="tablist"></ul>
                      </div>

                    </div>
                </div>
            </div>
          {# End Header / Navbar #}

            {# Body #}
            <div id="content-container" class="container" role="main">
                {% block outer_content %}
                    {% block precontent %}
                        {% include "distributed/partials/_messages.html" %}
                    {% endblock precontent %}
                    {% block content %}
                        {% block subnavbar %}{% endblock subnavbar %}
                    {% endblock content %}
                {% endblock outer_content %}
            </div>
        </div> {# End wrapper #}
        {# Footer #}
        {% include "distributed/partials/_footer.html" %}
    </body>

</html>
